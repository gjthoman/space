<!doctype html>
<meta charset="utf-8">
<title>Hello World</title>
<style>* {padding: 0; margin: 0}</style>
<body>
<script   src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>

<script src="pixi.min.js"></script>
<script src="pixicam.min.js"></script>

<script>
	var Container = PIXI.Container,
    autoDetectRenderer = PIXI.autoDetectRenderer,
    loader = PIXI.loader,
    resources = PIXI.loader.resources,
    Sprite = PIXI.Sprite;
    var ship, loop;
    var mousePos = {};
    var mouseThrottle;
    
    var thrust = .5;
    var isThrusting = false;

    var stage = new Container(),
        renderer = autoDetectRenderer(256, 256, {antialias: false});
        renderer.view.style.position = "absolute";
        renderer.view.style.display = "block";
        renderer.autoResize = true;
        renderer.resize(window.innerWidth, window.innerHeight);

    var world = new pixicam.World({
        screenWidth: window.innerWidth,
        screenHeight: window.innerHeight,
        width: 5000,
        height: 5000,
        x: 2500,
        y: 2500
    });

    var camera = world.camera;
    var instructions = new PIXI.Text('Use space to thrust.', {fill:'#CCCCCC'});
 
    // Position the text
    instructions.x = 20;
    instructions.y = 20;
    instructions.scale.x = instructions.scale.y = .5;
    
    // Add Player one Text to the stage
    stage.addChild(instructions);
 
    stage.addChild(world);
    
    document.body.appendChild(renderer.view);

    loader.add("ship.png").add("tile.png").load(setup);

    function setup() {
        ship = new Sprite(resources["ship.png"].texture);
        ship.scale.x = ship.scale.y = 1;
        ship.anchor.x = 0.5;
        ship.anchor.y = 0.5;

        ship.position.set(2500, 2500);
        loop = setInterval(function(){ update(); }, 30);
        
        var frame = PIXI.Texture.fromFrame("tile.png");
        var tiling = new PIXI.extras.TilingSprite(frame, 5000, 5000);
        tiling.alpha= 0.1;
        
        var graphics = new PIXI.Graphics();

        //graphics.beginFill(0xFFFF00);
        
        graphics.lineStyle(5, 0xFF0000);

        // draw a rectangle
        graphics.drawRect(0, 0, 5000, 5000);

        world.addChild(graphics);
        //tiling.pivot.set(0,frame.height);
        //tiling.x = 0;
        //tiling.y = 0;
        //tiling.tint = 0xc5c5c5;
        

        world.addChild(tiling);
        world.addChild(ship);
        stage.addChild(instructions);
        
        setupListeners();
    }
    
    function setupListeners() {
        mouseThrottle = false;
        
        $(document).mousemove(function(e){
            //console.log(world.getMousePosition());
            if (mouseThrottle) { return };
            mouseThrottle = true;
            mousePos = {
                x: e.pageX,
                y: e.pageY
            }
            setTimeout(function(){mouseThrottle = false;}, 30);
        });
        
        $(document).on('keydown', function(e) {
            switch (e.keyCode) {
                case 32:
                    isThrusting = true;
                break;
            }
            //handleKey(e);
        });

        $(document).on('keyup', function(e) {
            switch (e.keyCode) {
                case 32:
                    isThrusting = false;
                break;
            }
            //handleKey(e);
        });
    }
    var velocity = {
        x: 0,
        y: 0
    }
    
    function update(){
        var dx = mousePos.x - window.innerWidth/2;
        var dy = mousePos.y - window.innerHeight/2;
        var radians = Math.atan2(dy, dx);
        
        
        if(isThrusting){
            velocity.x += Math.cos(radians) * thrust;
            velocity.y += Math.sin(radians) * thrust;
        }
        
        velocity.x *= 0.99;
        velocity.y *= 0.99;

        camera.x = ship.x += velocity.x;
        camera.y = ship.y += velocity.y;

        ship.rotation = radians;
        
        world.update();
        renderer.render(stage);
    }
    
    Math.radians = function(degrees) {
        return degrees * Math.PI / 180;
    };

    Math.degrees = function(radians) {
        return radians * 180 / Math.PI;
    };
</script>
</body>